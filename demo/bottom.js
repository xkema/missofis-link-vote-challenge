!function(){"use strict";angular.module("com.missofis.linkvotechallenge",["ngRoute","ngAnimate"])}(),function(){"use strict";function configApp($locationProvider,$routeProvider){$locationProvider.hashPrefix("!"),$routeProvider.when("/",{templateUrl:"views/_home/view-home.html",controller:"HomeCtrl",controllerAs:"vm"}).when("/add",{templateUrl:"views/_add/view-add.html",controller:"AddCtrl",controllerAs:"vm"}).otherwise({templateUrl:"views/_error/view-error.html",redirectTo:"/404"})}function runApp(LinkVoteChallengeService){LinkVoteChallengeService.initAppData()}angular.module("com.missofis.linkvotechallenge").config(configApp).run(runApp),configApp.$inject=["$locationProvider","$routeProvider"],runApp.$inject=["LinkVoteChallengeService"]}(),function(){"use strict";function LinkVoteChallengeService($http){function _getAppData(){return JSON.parse(sessionStorage.getItem("mso-linkvotechallenge"))}function _setAppData(data,overwrite){var _appData=_getAppData();data.items&&(_appData.items=overwrite?data.items:_appData.items.concat(data.items)),data.userCheated&&(_appData.userCheated=data.userCheated),sessionStorage.setItem("mso-linkvotechallenge",JSON.stringify(_appData))}return{getMockItemsData:function(){return $http({method:"GET",url:"test/mock-data/items.json"})},addItem:function(item){var _item={id:Math.ceil(Math.random()*Date.now()),name:item.name,redirect_url:item.redirect_url,created_at:Date.now(),votes_count:0,last_voted_at:null,current_user_voted:!1},_appData=_getAppData();return _appData.items.unshift(_item),_setAppData({items:_appData.items},!0),_item},removeItem:function(item){var _appData=_getAppData();return _appData.items.forEach(function(currentValue,index){item.id===currentValue.id&&_appData.items.splice(index,1)}),_setAppData({items:_appData.items},!0),!0},upVoteItem:function(item){var _appData=_getAppData(),_item=null;return _appData.items.forEach(function(currentValue,index){item.id===currentValue.id&&(currentValue.votes_count++,currentValue.current_user_voted=!0,currentValue.last_voted_at=new Date,_item=currentValue)}),_setAppData({items:_appData.items},!0),_item},downVoteItem:function(item){var _appData=_getAppData(),_item=null;return _appData.items.forEach(function(currentValue,index){item.id===currentValue.id&&(currentValue.votes_count--,currentValue.current_user_voted=!1,currentValue.last_voted_at=new Date,_item=currentValue)}),_setAppData({items:_appData.items},!0),_item},initAppData:function(){var _appData={items:[],userCheated:!1};null===sessionStorage.getItem("mso-linkvotechallenge")&&sessionStorage.setItem("mso-linkvotechallenge",JSON.stringify(_appData))},getAppData:_getAppData,setAppData:_setAppData}}angular.module("com.missofis.linkvotechallenge").factory("LinkVoteChallengeService",LinkVoteChallengeService),LinkVoteChallengeService.$inject=["$http"]}(),function(){"use strict";function MsoLinkVotePaginationCtrl($log,$scope){function _updatePagination(){isNaN(parseFloat(vm.numItems))||isNaN(parseFloat(vm.itemsPerPage))||(vm.numPagesCalculated=Math.ceil(vm.numItems/vm.itemsPerPage))}var vm=this;vm.numPagesCalculated=1,vm.updatePagination=_updatePagination,vm.updatePage=function(direction){if("next"===direction&&vm.currentPage!==vm.numPagesCalculated)vm.currentPage++;else{if("prev"!==direction||1===vm.currentPage)return!1;vm.currentPage--}vm.updatePageData({page:vm.currentPage})},$log.info("$$____ :: CONTROLLER INITIALIZE","MsoLinkVotePaginationCtrl"),$scope.$watch("vm_.numItems",function(newValue,oldValue){parseInt(newValue)<=parseInt(vm.itemsPerPage)?vm.numPagesCalculated=1:_updatePagination()})}angular.module("com.missofis.linkvotechallenge").controller("MsoLinkVotePaginationCtrl",MsoLinkVotePaginationCtrl),MsoLinkVotePaginationCtrl.$inject=["$log","$scope"]}(),function(){"use strict";angular.module("com.missofis.linkvotechallenge").component("msoLinkVotePagination",{templateUrl:function(){return"common/_pagination/template-pagination.html"},controller:"MsoLinkVotePaginationCtrl",controllerAs:"vm_",bindings:{numItems:"@",itemsPerPage:"@",currentPage:"=",updatePageData:"&"}})}(),function(){"use strict";function MsoLinkVoteModalCtrl($log,$scope,$rootScope){var vm=this;vm.modalOpen=!1,vm.closeModal=function(){vm.modalOpen=!1},vm.doModalAction=function(){if(!_modalData)return!1;"mso.removeItem"===_modalData.targetAction&&$rootScope.$broadcast(_modalData.targetAction,_modalData.targetItem),vm.modalOpen=!1},vm.modalItem=null;var _modalData=null;$log.info("$$____ :: CONTROLLER INITIALIZE","MsoLinkVoteModalCtrl"),$scope.$on("mso.openModal",function(event,data){_modalData=data,vm.modalItem=_modalData.targetItem.item,vm.modalOpen=!0})}angular.module("com.missofis.linkvotechallenge").controller("MsoLinkVoteModalCtrl",MsoLinkVoteModalCtrl),MsoLinkVoteModalCtrl.$inject=["$log","$scope","$rootScope"]}(),function(){"use strict";angular.module("com.missofis.linkvotechallenge").component("msoLinkVoteModal",{templateUrl:function(){return"common/_modal/template-modal.html"},controller:"MsoLinkVoteModalCtrl",controllerAs:"vm_"})}(),function(){"use strict";function MsoLinkVoteToasterCtrl($log,$scope,$timeout,$sce){var vm=this;vm.toasterOpen=!1,vm.toasterMessage=null,vm.toasterItem=null;var _toasterPromise=null;$log.info("$$____ :: CONTROLLER INITIALIZE","MsoLinkVoteToasterCtrl"),$scope.$on("mso.showToaster",function(event,data){var _previousMessage=vm.toasterMessage;if("mso.itemAdded"===data.toasterType)vm.toasterMessage=$sce.trustAsHtml('"<strong>'+data.targetItem.item.name+'"</strong> item added!');else if("mso.itemRemoved"===data.toasterType)vm.toasterMessage=$sce.trustAsHtml('Item "<strong>'+data.targetItem.item.name+'</strong>" removed succesfully!');else{if("mso.simpleToast"!==data.toasterType)return!1;vm.toasterMessage=$sce.trustAsHtml(data.message)}vm.toasterOpen&&(vm.toasterMessage=$sce.trustAsHtml(vm.toasterMessage+"<br>"+_previousMessage),$timeout.cancel(_toasterPromise)),vm.toasterOpen=!0,_toasterPromise=$timeout(function(){vm.toasterOpen=!1,_toasterPromise=null},4e3)})}angular.module("com.missofis.linkvotechallenge").controller("MsoLinkVoteToasterCtrl",MsoLinkVoteToasterCtrl),MsoLinkVoteToasterCtrl.$inject=["$log","$scope","$timeout","$sce"]}(),function(){"use strict";angular.module("com.missofis.linkvotechallenge").component("msoLinkVoteToaster",{templateUrl:function(){return"common/_toaster/template-toaster.html"},controller:"MsoLinkVoteToasterCtrl",controllerAs:"vm_"})}(),function(){"use strict";function HomeCtrl($log,LinkVoteChallengeService,$scope,$timeout,$rootScope){function _sortItemsByCreationDate(items,reversed){return reversed=reversed?-1:1,items.sort(function(a,b){return reversed*(new Date(b.created_at)-new Date(a.created_at))})}function _getAppData(){return LinkVoteChallengeService.getAppData()}var vm=this;vm.links=null,vm.linksPaged=null,vm.listOrder="",vm.paginationData={itemsPerPage:5,currentPage:1},vm.disableRemove=!1,vm.showExtras=!1,vm.sortItemsByCreationDate=_sortItemsByCreationDate,vm.sortItemsByVoteCount=function(items,reversed){return reversed=reversed?-1:1,items.sort(function(a,b){return reversed*(b.votes_count-a.votes_count)||reversed*(new Date(b.last_voted_at)-new Date(a.last_voted_at))})},vm.upVote=function(item,index){var _indexInOriginalArray=index+(vm.paginationData.currentPage-1)*vm.paginationData.itemsPerPage,_item=LinkVoteChallengeService.upVoteItem(item);if(vm.links[_indexInOriginalArray]=_item,""!==vm.listOrder){var isReversed="increasing"===vm.listOrder;vm.sortItemsByVoteCount(vm.links,isReversed)}},vm.downVote=function(item,index){var _indexInOriginalArray=index+(vm.paginationData.currentPage-1)*vm.paginationData.itemsPerPage,_item=LinkVoteChallengeService.downVoteItem(item);if(vm.links[_indexInOriginalArray]=_item,""!==vm.listOrder){var isReversed="increasing"===vm.listOrder;vm.sortItemsByVoteCount(vm.links,isReversed)}},vm.getAppData=_getAppData,vm.removeLinkPrelude=function(item,index){var _indexInOriginalArray=index+(vm.paginationData.currentPage-1)*vm.paginationData.itemsPerPage;$rootScope.$broadcast("mso.openModal",{targetAction:"mso.removeItem",targetItem:{item:item,index:_indexInOriginalArray}})},vm.removeLink=function(item,index){var _itemRemoved=LinkVoteChallengeService.removeItem(item);vm.disableRemove=!0,$timeout(function(){vm.disableRemove=!1,_itemRemoved&&(vm.links.splice(index,1),$rootScope.$broadcast("mso.showToaster",{toasterType:"mso.itemRemoved",targetItem:{item:item}}))},1e3)},vm.changeOrder=function(){""===vm.listOrder?vm.sortItemsByCreationDate(vm.links,!1):"decreasing"===vm.listOrder?vm.sortItemsByVoteCount(vm.links,!1):"increasing"===vm.listOrder&&vm.sortItemsByVoteCount(vm.links,!0)},vm.getItems=function(pageNumber){0!==vm.links.length&&pageNumber>Math.ceil(vm.links.length/vm.paginationData.itemsPerPage)&&(vm.paginationData.currentPage=--pageNumber),vm.linksPaged=vm.links.slice((pageNumber-1)*vm.paginationData.itemsPerPage,pageNumber*vm.paginationData.itemsPerPage)},vm.toggleExtras=function(){vm.showExtras=!vm.showExtras},function(){$log.info("$$____ :: CONTROLLER INITIALIZE","HomeCtrl");var _appData=_getAppData();vm.links=_sortItemsByCreationDate(_appData.items,!1),0===vm.links.length&&$rootScope.$broadcast("mso.showToaster",{toasterType:"mso.simpleToast",message:"No items to list, add some!"}),$scope.$watchCollection("vm.links",function(){vm.getItems(vm.paginationData.currentPage)}),$scope.$on("mso.removeItem",function(event,data){vm.removeLink(data.item,data.index)})}()}angular.module("com.missofis.linkvotechallenge").controller("HomeCtrl",HomeCtrl),HomeCtrl.$inject=["$log","LinkVoteChallengeService","$scope","$timeout","$rootScope"]}(),function(){"use strict";function AddCtrl($log,LinkVoteChallengeService,$rootScope,$timeout){var vm=this;vm.disableAdd=!1,vm.formData={linkName:"at-"+Date.now(),linkUrl:"http://at-"+Date.now()+".com"},vm.link=null,vm.addLink=function(){var _item={name:vm.formData.linkName,redirect_url:vm.formData.linkUrl};vm.disableAdd=!0,$timeout(function(){var _itemAdded=LinkVoteChallengeService.addItem(_item);vm.disableAdd=!1,_itemAdded&&($rootScope.$broadcast("mso.showToaster",{toasterType:"mso.itemAdded",targetItem:{item:_item}}),vm.link=_itemAdded,vm.formData={linkName:"",linkUrl:""})},1e3)},vm.cheetah=function(){vm.disableAdd=!0,LinkVoteChallengeService.getMockItemsData().then(function(response){LinkVoteChallengeService.setAppData({items:response.data.posts,userCheated:!0},!1),$timeout(function(){vm.isUserCheated=!0,vm.disableAdd=!1,$rootScope.$broadcast("mso.showToaster",{toasterType:"mso.simpleToast",message:"You've added <strong>25 items</strong> with some kind of poisonous elixir!"})},1e3)})},vm.isUserCheated=!0,$log.info("$$____ :: CONTROLLER INITIALIZE","AddCtrl"),vm.isUserCheated=LinkVoteChallengeService.getAppData().userCheated}angular.module("com.missofis.linkvotechallenge").controller("AddCtrl",AddCtrl),AddCtrl.$inject=["$log","LinkVoteChallengeService","$rootScope","$timeout"]}();